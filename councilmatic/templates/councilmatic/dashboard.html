{% extends "base.html" %}
{% load i18n %}
{% load compress %}
{% load url from future %}

{% block load_early %}
<!--  <link rel="stylesheet" href="{{ STATIC_URL }}phillyleg/legislation.css">-->
<!--  <link rel="stylesheet" href="{{ STATIC_URL }}main/app_dashboard.css">-->
{% endblock %}

{% block content %}
<div id="dashboard">
  <div class='row-fluid'>
    <div class='offset1 span10'>
      <p class='lead'>Keep tabs on what your City Council is doing.</p>
      <section id="dashboard-search" class="hero-unit">
        <header>
            <h2>{% trans "Find legislation" %}</h2>
        </header>

        <form class="search form-search" action="{% url 'search' %}" method="GET">
          <div class="ctrlHolder">
            <input name="q" type="text" class="input-xxlarge" placeholder="Rahm Emanuel, zoning, resolution #R2013-1, etc.">
            <button type="submit" class="btn btn-large btn-info">{% trans "Search" %}</button>
          </div>
        </form>
      </section>
    </div>
  </div> <!-- row-fluid -->
  <div class='row-fluid'>
    <section id="dashboard-legislation" class="row-fluid">
      <div id="dashboard-legislation-list" class="offset1 span6">
        <h3>{% trans "Most recent" %}</h3>

        {% include "councilmatic/partials/legfile_list.html" %}

        <a href="/search">More...</a>
      </div> <!-- #dashboard-legislation-list -->

      <div id="dashboard-legislation-map" class="span4">
        <h3>Legislation in the last month</h3>
        <div class='accordion'>
        {% for topic in routine_topics %}
          <div class='accordion-group'>
            <div class='accordion-heading'>
              <a href='#' class='accordion-toggle pull-left'>
                <i class='icon-none'></i>
              </a>
              <h4><strong>{{topic.leg_count}}</strong> <a href='/search?q=&topics={{topic.topic}}'>{{topic.topic}}</a></h4>
            </div>
          </div>
        {% endfor %}
        </div>

        <h4>By topic</h4>
        <div class='accordion' id='view_accordion'>
          {% for topic in recent_topics %}
            <div class='accordion-group'>
              <div class='accordion-heading'>
                {% if topic.children %}
                  <a class='accordion-toggle pull-left' data-parent='#view_accordion' data-toggle='collapse' data-view='{{topic.topic}}' href='#category_{{topic.id}}'>
                    <i class='icon-plus'></i>
                  </a>
                {% else %}
                  <a href='#' class='accordion-toggle pull-left'>
                    <i class='icon-none'></i>
                  </a>
                {% endif %}
                <h4><strong>{{topic.leg_count}}</strong> <a href='/search?q=&topics={{topic.topic}}'>{{topic.topic}}</a></h4>
                <div class='clearfix'></div>
              </div>
              {% if topic.children %}
                <div class='accordion-body collapse' id='category_{{topic.id}}'>
                  <div class='accordion-inner' id='category_inner_{{topic.id}}'>
                    <ul>
                    {% for child in topic.children %}
                      <li>
                        <strong>{{child.leg_count}}</strong> <a href='/search?q=&topics={{child.topic}}'>{{child.topic}}</a>
                        {% if child.children %}
                          <ul>
                          {% for second_child in child.children %}
                            <li><strong>{{second_child.leg_count}}</strong> <a href='/search?q=&topics={{second_child.topic}}'>{{second_child.topic}}</a></li>
                          {% endfor%}
                          </ul>
                        {% endif %}
                      </li>
                    {% endfor%}
                    </ul>
                  </div>
                </div>
              {% endif %}
            </div>
          {% endfor %}
        </div>

        <h4>Top sponsors</h4>
        {% for sponsor in sponsors %}
          <h4>
            <img class='img-polaroid' style="width: 30px;" src="{{STATIC_URL}}{{ sponsor.headshot }}" alt="{{ sponsor.name }}" title="{{ sponsor.name }}">
            <strong>{{sponsor.leg_count}}</strong> <a href='/member/{{sponsor.id}}'>{{sponsor.name}}</a>
            <small>{{sponsor.title}}</small>
          </h4>
        {% endfor %}

    </section> <!-- dashboard-legislation -->
  </div>     <!-- dashboard -->
</div>    <!-- row-fluid -->
{% endblock %}

{% block load_late %}
  {# {% compress js %} #}
  <script src="{{ STATIC_URL }}main/dashboard_search.js"></script>
  {# {% endcompress %} #}
{% endblock %}
