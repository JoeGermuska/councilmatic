{% extends "base.html" %}
{% load url from future %}
{% load compress %}

{% block load_early %}
  {% compress css %}
<!--	<link rel="stylesheet" href="{{ STATIC_URL }}phillyleg/minutes.css">-->
<!--	<link rel="stylesheet" href="{{ STATIC_URL }}phillyleg/legislation.css">-->
<!--  <link rel="stylesheet" href="{{ STATIC_URL }}main/app_dashboard.css">-->
  {% endcompress %}
{% endblock %}

{% block content %}
<div class="councilmember-detail dashboard">
<div class="block">
    <div class="content">
    <div class="inner">
        <header>
            <h1>
                <img alt="{{ councilmember.name }}" src="{{STATIC_URL}}{{ councilmember.headshot }}">
                {{ councilmember.name }}
            </h1>
        </header>

        <!------------------------------------------------------
          -- The council member's recently sponsored legislation
          -->
        <div id="dashboard_legislation" class="councilmember-detail__recent-legislation">
            <h2>Recent Legislation</h2>

            <ul>
            {% for file, bookmark, contenttype, bookmark_form in bookmark_data %}
                <li>
                    {% include "main/partials/dashboard_legfile_teaser.html" %}
                </li>
            {% endfor %}
            </ul>
        </div>

        <!-------------------------------------------------------
          -- The council member's district geography
          -->
        <div style="float: right;">
            <h2>District Geography</h2>

            <div style="border:1px solid grey">
            <div id="councilmember_district_map_cavas"
                 style="
                    width:420px;
                    height:300px;">
            </div>
            </div>

            <script type="text/javascript"
                src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
            <script src="{{ STATIC_URL}}libs/GeoJSON.js"></script>
            <script type="text/javascript">
              var map;
              var initialize = function() {
                var myOptions = {
                      zoom: 10,
                      center: new google.maps.LatLng(40.006054, -75.147858),
                      mapTypeId: google.maps.MapTypeId.ROADMAP
                    },
                    latlngs = [];

                map = new google.maps.Map(document.getElementById('councilmember_district_map_cavas'),
                    myOptions);

                var districtOptions = {
                    map: map,
                    title: "District {{ district.id }}"
                }
                var districtVector = new GeoJSON('{"feature": {"attributes": {}, "geometry": {{ district.shape.geojson|default:"{}"|safe }} } }', districtOptions);
                debugger;
                zoomToFitVector(map, districtVector)
              };

              var zoomToFitVector = function(map, vector) {
                //  Create a new viewpoint bound
                var bounds = new google.maps.LatLngBounds ();
                //  Go through each...
                for (var i = 0, numlatlngs = latlngs.length; i < numlatlngs; i++) {
                  //  And increase the bounds to take this point
                  bounds.extend (latlngs[i]);
                }
                //  Fit these bounds to the map
                map.fitBounds (bounds);
              };

              google.maps.event.addDomListener(window, 'load', initialize);
            </script>

        </div>

    </div>
    </div>
</div>
</div>
{% endblock %}
